async function getIdFromCVE(cve: string) {
  const body = {
    pageIndex: 1,
    pageSize: 10,
    keyword: cve,
  };

  const response = await fetch(
    "https://www.cnnvd.org.cn/web/homePage/cnnvdVulList",
    {
      method: "POST",
      headers: {
        "content-type": "application/json;charset=UTF-8",
      },
      body: JSON.stringify(body),
    }
  ).then((res) => res.json());

  const record = response.data.records[0];
  return {
    id: record.id,
    cnnvdCode: record.cnnvdCode,
    vulType: record.vulType,
  };
}

async function getCveDetail(cve: string) {
  const response = await fetch(
    "https://www.cnnvd.org.cn/web/cnnvdVul/getCnnnvdDetailOnDatasource",
    {
      method: "POST",
      headers: {
        "content-type": "application/json;charset=UTF-8",
      },
      body: JSON.stringify(await getIdFromCVE(cve)),
    }
  ).then((res) => res.json());

  const detail = response.data.cnnvdDetail;
  // console.log(detail);
  return {
    vulName: detail.vulName,
    vulDesc: detail.vulDesc,
    vulType: detail.vulType,
    cnnvdCode: detail.cnnvdCode,
    cveCode: detail.cveCode,
    vendor: detail.affectedVendor,
    level: detail.hazardLevel,
    publishTime: detail.publishTime,
    updateTime: detail.updateTime,
  };
}

const keyword = prompt("Please input CVE or CNNVD code:") || Deno.exit(0);
const detail = await getCveDetail(keyword);

console.log("===");
console.log("Vul Name     :", detail.vulName);
console.log("CNNVD Code   :", detail.cnnvdCode);
console.log("CVE Code     :", detail.cveCode);
console.log("Vul Desc     :", detail.vulDesc);
console.log("Vul Type     :", detail.vulType);
console.log("Vendor       :", detail.vendor);
console.log("Level        :", detail.level);
console.log("Publish Time :", detail.publishTime);
console.log("Update Time  :", detail.updateTime);
