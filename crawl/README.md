# 爬虫源代码

爬虫使用 TypeScript 语言编写，基于 Deno 运行时。

```ts
async function getIdFromCVE(cve: string) {
  const body = {
    pageIndex: 1,
    pageSize: 10,
    keyword: cve,
  };

  const response = await fetch(
    "https://www.cnnvd.org.cn/web/homePage/cnnvdVulList",
    {
      method: "POST",
      headers: {
        "content-type": "application/json;charset=UTF-8",
      },
      body: JSON.stringify(body),
    }
  ).then((res) => res.json());

  const record = response.data.records[0];
  return {
    id: record.id,
    cnnvdCode: record.cnnvdCode,
    vulType: record.vulType,
  };
}

async function getCveDetail(cve: string) {
  const response = await fetch(
    "https://www.cnnvd.org.cn/web/cnnvdVul/getCnnnvdDetailOnDatasource",
    {
      method: "POST",
      headers: {
        "content-type": "application/json;charset=UTF-8",
      },
      body: JSON.stringify(await getIdFromCVE(cve)),
    }
  ).then((res) => res.json());

  const detail = response.data.cnnvdDetail;
  // console.log(detail);
  return {
    vulName: detail.vulName,
    vulDesc: detail.vulDesc,
    vulType: detail.vulType,
    cnnvdCode: detail.cnnvdCode,
    cveCode: detail.cveCode,
    vendor: detail.affectedVendor,
    level: detail.hazardLevel,
    publishTime: detail.publishTime,
    updateTime: detail.updateTime,
  };
}

const keyword = prompt("Please input CVE or CNNVD code:") || Deno.exit(0);
const detail = await getCveDetail(keyword);

console.log("===");
console.log("Vul Name     :", detail.vulName);
console.log("CNNVD Code   :", detail.cnnvdCode);
console.log("CVE Code     :", detail.cveCode);
console.log("Vul Desc     :", detail.vulDesc);
console.log("Vul Type     :", detail.vulType);
console.log("Vendor       :", detail.vendor);
console.log("Level        :", detail.level);
console.log("Publish Time :", detail.publishTime);
console.log("Update Time  :", detail.updateTime);
```

上面的代码实现了一个从 CNNVD（全国信息安全漏洞库）中查询 CVE 漏洞信息的功能。 下面是每个函数的具体作用：

- `getIdFromCVE(cve: string)` 这个函数接受一个 string 类型的参数 cve，在 CNNVD 官网搜索 CVE 漏洞信息，并返回包含漏洞信息的 JSON 对象。
- `getCveDetail(cve: string)` 这个函数接受一个 string 类型的参数 cve，调用 `getIdFromCVE(cve)` 来获取 CVE 漏洞的 id 等信息。之后通过调用另外一个接口获取 CVE 漏洞的详细信息，如漏洞名称、描述、类型、厂商、等级、发布时间和更新时间等。

接下来从控制台中读入用户输入的关键字（即 CVE 或 CNNVD 代码），调用 `getCveDetail` 函数，获取包含漏洞信息的 JSON 对象。最后，将获取的 CVE 漏洞信息打印到控制台上。

下面是这个爬虫的运行结果：

![](./example.png)
